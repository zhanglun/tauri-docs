/*! For license information please see e12f9555.c78e3d12.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[324],{401:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return u})),n.d(t,"default",(function(){return p}));var r=n(3),a=n(7),i=(n(0),n(454)),o=n(458),l={title:"Anti Bloat"},s={unversionedId:"usage/guides/bundler/anti-bloat",id:"usage/guides/bundler/anti-bloat",isDocsHomePage:!1,title:"Anti Bloat",description:"The following links have tutorials on reducing the size of your installers:",source:"@site/docs/en/usage/guides/bundler/anti-bloat.md",sourceDirName:"usage/guides/bundler",slug:"/usage/guides/bundler/anti-bloat",permalink:"/en/docs/usage/guides/bundler/anti-bloat",editUrl:"https://github.com/tauri-apps/tauri-docs/edit/dev/docs/en/usage/guides/bundler/anti-bloat.md",version:"current",frontMatter:{title:"Anti Bloat"},sidebar:"docs",previous:{title:"Introduction",permalink:"/en/docs/usage/guides/bundler/introduction"},next:{title:"Sidecar (Embedding External Binaries)",permalink:"/en/docs/usage/guides/bundler/sidecar"}},u=[{value:"Rust Compression Features",id:"rust-compression-features",children:[]},{value:"Stripping",id:"stripping",children:[]},{value:"Allowlist config",id:"allowlist-config",children:[]},{value:"UPX",id:"upx",children:[]}],c={toc:u};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The following links have tutorials on reducing the size of your installers:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/RazrFalcon/cargo-bloat"},"https://github.com/RazrFalcon/cargo-bloat")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html"},"https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://doc.rust-lang.org/cargo/reference/manifest.html#the-profile-sections"},"https://doc.rust-lang.org/cargo/reference/manifest.html#the-profile-sections"))),Object(i.b)("h3",{id:"rust-compression-features"},"Rust Compression Features"),Object(i.b)("p",null,"Add this to your ",Object(i.b)("inlineCode",{parentName:"p"},"src-tauri/Cargo.toml")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},'[profile.release]\npanic = "abort"\ncodegen-units = 1\nlto = true\nincremental = false\nopt-level = "s"\n')),Object(i.b)(o.a,{title:"Note",mdxType:"Alert"},Object(i.b)("p",null,"There is also ",Object(i.b)("inlineCode",{parentName:"p"},'opt-level = "z"')," available to try to reduce the resulting binary size. ",Object(i.b)("inlineCode",{parentName:"p"},'"s"')," and ",Object(i.b)("inlineCode",{parentName:"p"},'"z"')," can sometimes be smaller than the other, so test it with your own application!"),Object(i.b)("p",null,"We've seen smaller binary sizes from ",Object(i.b)("inlineCode",{parentName:"p"},'"s"')," for Tauri example applications, but real world applications can always differ.")),Object(i.b)("h4",{id:"unstable-rust-compression-features"},"Unstable Rust Compression Features"),Object(i.b)(o.a,{type:"warning",title:"Warning",icon:"alert",mdxType:"Alert"},"The following suggestions are all unstable features and require a nightly toolchain. See the ",Object(i.b)("a",{href:"https://doc.rust-lang.org/cargo/reference/unstable.html#unstable-features"},"Unstable Features")," documentation for more information of what this involves."),Object(i.b)("p",null,"The following methods involve using unstable compiler features and require having a rust nightly toolchain installed. If you don't have the nightly toolchain + ",Object(i.b)("inlineCode",{parentName:"p"},"rust-src")," nightly component added, try the following:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ rustup toolchain install nightly\n$ rustup component add rust-src --toolchain nightly\n")),Object(i.b)("p",null,"The Rust Standard Library comes precompiled. You can instead apply the optimization options used for the rest of your binary + dependencies to the std with an unstable flag. This flag requires specifying your target, so know the target triple that you are targeting."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ cargo +nightly build --release -Z build-std --target x86_64-unknown-linux-gnu\n")),Object(i.b)("p",null,"If you are using ",Object(i.b)("inlineCode",{parentName:"p"},'panic = "abort"')," in your release profile optimizations, then you need to make sure the ",Object(i.b)("inlineCode",{parentName:"p"},"panic_abort")," crate is compiled with std. Additionally, an extra std feature can be used to further reduce the binary size. The following applies both:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ cargo +nightly build --release -Z build-std=std,panic_abort -Z build-std-features=panic_immediate_abort --target x86_64-unknown-linux-gnu\n")),Object(i.b)("p",null,"See the unstable documentation for more details about ",Object(i.b)("a",{parentName:"p",href:"https://doc.rust-lang.org/cargo/reference/unstable.html#build-std"},Object(i.b)("inlineCode",{parentName:"a"},"-Z build-std"))," and ",Object(i.b)("a",{parentName:"p",href:"https://doc.rust-lang.org/cargo/reference/unstable.html#build-std-features"},Object(i.b)("inlineCode",{parentName:"a"},"-Z build-std-features")),"."),Object(i.b)("h3",{id:"stripping"},"Stripping"),Object(i.b)("p",null,"Binary size can easily be reduced by stripping out debugging information from binaries that ship to end users. This is not good for debuggable builds, but means good binary size savings for end user binaries. The easiest way is to use the famous ",Object(i.b)("inlineCode",{parentName:"p"},"strip")," utility to remove this debugging information."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ strip target/release/my_application\n")),Object(i.b)("p",null,"See your local ",Object(i.b)("inlineCode",{parentName:"p"},"strip")," manpage for more information and flags that can be used to specify what information gets stripped out from the binary."),Object(i.b)("h3",{id:"allowlist-config"},"Allowlist config"),Object(i.b)("p",null,"You can also reduce the application size with the ",Object(i.b)("inlineCode",{parentName:"p"},"allowlist")," config, and only enabling what you need. Sometimes this is useful with Tauri's ",Object(i.b)("a",{parentName:"p",href:"/docs/usage/patterns/bridge"},"Bridge-Pattern")," or others, depending on needs."),Object(i.b)("p",null,"For example in ",Object(i.b)("inlineCode",{parentName:"p"},"tauri.conf.json")," file:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "tauri": {\n    "allowlist": {\n      "all": false,\n      "fs": {\n        "writeFile": true,\n        "writeBinaryFile": true\n      },\n      "shell": {\n        "execute": true\n      },\n      "dialog": {\n        "save": true\n      }\n    }\n  }\n}\n')),Object(i.b)("h3",{id:"upx"},"UPX"),Object(i.b)("p",null,"UPX, ",Object(i.b)("strong",{parentName:"p"},"Ultimate Packer for eXecutables"),", is a dinosaur amongst the binary packers. This 23-year old, well-maintained piece of kit is GPL-v2 licensed with a pretty liberal usage declaration. Our understanding of the licensing is that you can use it for any purposes (commercial or otherwise) without needing to change your license unless you modify the source code of UPX."),Object(i.b)("p",null,"Basically it compresses the binary and decompresses it at runtime. It should work for pretty much any binary type out there. Read more: ",Object(i.b)("a",{parentName:"p",href:"https://github.com/upx/upx"},"https://github.com/upx/upx")),Object(i.b)(o.a,{type:"warning",title:"Warning",icon:"alert",mdxType:"Alert"},"You should know that this technique might flag your binary as a virus on Windows and macOS - so use at your own discretion, and as always validate with [Frida](https://frida.re/docs/home/) and do real distribution testing!"),Object(i.b)("h4",{id:"usage-on-macos"},"Usage on macOS"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"$ brew install upx\n$ yarn tauri build\n$ upx --ultra-brute src-tauri/target/release/bundle/macos/app.app/Contents/macOS/app\n                       Ultimate Packer for eXecutables\n                          Copyright (C) 1996 - 2018\nUPX 3.95        Markus Oberhumer, Laszlo Molnar & John Reiser   Aug 26th 2018\n\n        File size         Ratio      Format      Name\n   --------------------   ------   -----------   -----------\n    963140 ->    274448   28.50%   macho/amd64   app\n")))}p.isMDXComponent=!0},454:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),c=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,m=p["".concat(o,".").concat(d)]||p[d]||b[d]||i;return n?a.a.createElement(m,l(l({ref:t},u),{},{components:n})):a.a.createElement(m,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},455:function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var i=typeof r;if("string"===i||"number"===i)e.push(r);else if(Array.isArray(r)){if(r.length){var o=a.apply(null,r);o&&e.push(o)}}else if("object"===i)if(r.toString===Object.prototype.toString)for(var l in r)n.call(r,l)&&r[l]&&e.push(l);else e.push(r.toString())}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(r=function(){return a}.apply(t,[]))||(e.exports=r)}()},456:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(455),o=n.n(i);const l={danger:"var(--ifm-color-danger)",warning:"var(--ifm-color-warning)",info:"var(--ifm-color-info)",default:"var(--ifm-font-base-color)"};t.a=({title:e,className:t,color:n="default"})=>a.a.createElement("i",{className:o()("ti-"+e,t),style:{color:l[n]}})},458:function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(455),o=n.n(i),l=n(456),s=n(56),u=n.n(s);t.a=({type:e="info",title:t,icon:n,children:r})=>a.a.createElement("div",{className:o()("alert","alert--"+e,u.a.alert),style:{marginBottom:"30px"},role:"alert"},n&&a.a.createElement(a.a.Fragment,null,a.a.createElement(l.a,{title:n,className:u.a.icon}),"\xa0"),a.a.createElement("div",{className:u.a.container},t&&a.a.createElement("span",{className:u.a.title},t),a.a.createElement("div",{className:u.a.content},r)))}}]);